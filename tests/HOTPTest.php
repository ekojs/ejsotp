<?php declare(strict_types=1);

namespace EJSHelper\Tests;

use PHPUnit\Framework\TestCase;
use Ekojs\Otp\HOTP;

class HOTPTest extends TestCase {
    private $hotp;

    protected function setUp(): void
    {
        $this->hotp = HOTP::getInstance();
        $this->hotp->createOTP([
            "secret" => "mysecret",
            "counter" => 1000
        ]);
        $this->hotp->otp->setLabel('ekojs@email.com');
        $this->hotp->otp->setIssuer("My Service HOTP");
    }

    public function testGenerateHotp(): void
    {
        $this->assertEquals("983261",$this->hotp->otp->at(1000));
    }

    public function testVerifyTotp(): void
    {
        $this->assertTrue($this->hotp->otp->verify("983261",1000));
    }

    public function testGetParameters(): void
    {
        $this->assertIsArray($this->hotp->getParams());
    }

    // public function testGetProvisioningUri(): void 
    // {
    //     $this->assertEquals("otpauth://hotp/My%20Service%20HOTP%3Aekojs%40email.com?counter=1000&issuer=My%20Service%20HOTP&secret=VZCKGWRLS7CINEYALENYPH5T442LJUAFGSNCBTBQEHMN5GSVGTJCD2B7NHCZFK5FZ3QHTQ66JYDMNUI2UBWZJAYHI62VYVHVUGTO6SQ",$this->hotp->otp->getProvisioningUri());
    // }

    public function testGenerateQr(): void
    {
        $this->assertEquals("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAFACAIAAABC8jL9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAH20lEQVR4nO3dy24jNxRAwTjI///yZDfIohGwTfFxPFVrSS1ZPiCgC7K/fv369RfQ9PfpNwB8n4AhTMAQJmAIEzCECRjCBAxhAoYwAUOYgCFMwBAmYAgTMIQJGMIEDGH/vH3C19fXivcxY3JL8+MnenzNs48cN/kdrfhEk1df4Wf8J1uBIUzAECZgCBMwhAkYwgQMYa/HSI8u/Ol/xZBg/GOueOT4J1ox3Xl04QTu0YqvY9Knvg4rMIQJGMIEDGEChjABQ5iAIewzY6RHZ3elbNuiNPn08UeOP/3sCG386WeHguNu3l9lBYYwAUOYgCFMwBAmYAgTMIQtHCOdNblVZdvIZ8Voaptt85ULP/slrMAQJmAIEzCECRjCBAxhAoawHztG2naw26PJfTbjo6nJqz/aNgNb8ZbGn/4zWIEhTMAQJmAIEzCECRjCBAxhC8dIF26U2XYq3aOzZ+KNX+js1cdtmxTePIWyAkOYgCFMwBAmYAgTMIQJGMI+M0Y6e+uaSSumJit2I22b7my7+oq/56Tcf7IVGMIEDGEChjABQ5iAIUzAEPZ6jHTzzoz/OjuJ2WbFvOrRiinUpG13ZrqZFRjCBAxhAoYwAUOYgCFMwBD2eoy0bbvG2V0pf4gV07Kzx8ptO6bvkpGkFRjCBAxhAoYwAUOYgCFMwBB2xb2RJn/6H3/NcWfvu3P2s6+429PZrT9nR5JLP7sVGMIEDGEChjABQ5iAIUzAEPb1kd+4z85sVgwJLpxXbdskVPnsZw8ePLvp6jcrMIQJGMIEDGEChjABQ5iAIeze3Ujbhhnjr7li883kzY0mbRvg/bxHPtq/7ckKDGEChjABQ5iAIUzAECZgCHu9G+nCu+lsOxfu7DadcWd3Yp2d2Ty6ZOfQClZgCBMwhAkYwgQMYQKGMAFD2MIx0oWDnBXjmconWjGembzQ5NXPfsWX/H9agSFMwBAmYAgTMIQJGMIEDGGfGSOddfbGOdv+INs2CU2qXKhyC6j/ZwWGMAFDmIAhTMAQJmAIEzCEvR4jvXjpXdtfxm27yc2FB7ttc3Y30jaX7AOzAkOYgCFMwBAmYAgTMIQJGML++cirbNv+suIX+bNblM7uHJq04s2fndVdMhwaZwWGMAFDmIAhTMAQJmAIEzCEvR4jrZgHjD9928Fu26ZQF96yaNtnn/w2L5yr7d9bZgWGMAFDmIAhTMAQJmAIEzCEvR4jnT1zbNts6dHZE+TO7ls6e1Tdto1HZ//BvsEKDGEChjABQ5iAIUzAECZgCPvMoXbjtu1fGX/6igHJ+Dhhcoi1bZQy/pbGXTgYyx1/ZwWGMAFDmIAhTMAQJmAIEzCEfb395XrFrWsudOFWlf07Xb5n276l8aufHfks/eKswBAmYAgTMIQJGMIEDGEChrDdh9qtGHtUJgfjj5zct3R2kDP+mmaK3376b1ZgCBMwhAkYwgQMYQKGMAFD2GcOtbvwZjzjr7ltwnH2/kDjF9p29RVH6v1p96+yAkOYgCFMwBAmYAgTMIQJGMI+M0ba9tv92SHBtt1IKx45PnRZMVsat23T1fjVt213+wYrMIQJGMIEDGEChjABQ5iAIewzY6RtVmx/udCF91tacU+ssx9z0oqzEL/BCgxhAoYwAUOYgCFMwBAmYAh7PUY6+4P+2VsrrRiljL+lFRfaZsVsadKKw/f2f0wrMIQJGMIEDGEChjABQ5iAIWzhbqQVv56fHZCsOALu0dn5yqNt86rJ19z2H3LJAM8KDGEChjABQ5iAIUzAECZgCPtaN5y45NSv/3KDn28/fYWzX8fZjXGfmhRagSFMwBAmYAgTMIQJGMIEDGGvx0gXnrdWGRJsu/oKZ++NNG7btMyhdsAsAUOYgCFMwBAmYAgTMIR95lC7Cwc5Ky40Pg9YMU44+/Sz+6vGL7Ti4MEL7zX1mxUYwgQMYQKGMAFDmIAhTMAQ9pndSCtmDNsmMeNXn3zNFS45Wm31a267+orZ0tLPbgWGMAFDmIAhTMAQJmAIEzCEfWY30qSzx6CNu3BEMWnyL18Zukz+Pbcd5OjeSPBnETCECRjCBAxhAoYwAUPYwjHSihnD2dnSii1K2zZITZ5ft+Ivf+HAKccKDGEChjABQ5iAIUzAECZgCHt9qF3Fii01Z69e2fpz1rZv89H+fXVWYAgTMIQJGMIEDGEChjABQ9jr3UhnbwX0aNuxcpMbeiYfOW78E22719QKF97Daf8fxAoMYQKGMAFDmIAhTMAQJmAI+8yhdts2tWw7Am78kdv2GJ0dd40/fdusbnJms22A9+hTQywrMIQJGMIEDGEChjABQ5iAIWz3vZHGnd0XsuKwuBVTk7M7ci48kW9809U2DrUDngkYwgQMYQKGMAFDmIAhbOEY6UIrNt88WrHD6cKz5i48kW/yNScnW+NX/xQrMIQJGMIEDGEChjABQ5iAIezPGiONWzGJObvxaHJAsmLocnZ317a3NP70b7ACQ5iAIUzAECZgCBMwhAkYwhaOkbbdMGnSz7vfUuUtjascvufeSMALAoYwAUOYgCFMwBAmYAj7evvL9dnbzDzadoudybf0aNs9nLZNdyZtmz6m3/xvVmAIEzCECRjCBAxhAoYwAUPY6zEScA8rMIQJGMIEDGEChjABQ5iAIUzAECZgCBMwhAkYwgQMYQKGMAFDmIAhTMAQJmAI+xdTe8G5ySBw3AAAAABJRU5ErkJggg==",$this->hotp->generateQr()->getDataUri());
    }

    public function testGenerateQrWithLogoAndLabel(): void
    {
        $this->assertEquals("data:image/png;base64,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",$this->hotp->generateQr("./tests/logo.png",true)->getDataUri());
    }

    public function testCreateHotp(): void 
    {
        $otp = $this->hotp->createOTP([
            "secret" => "mysecret1234567890",
            "counter" => 1000
        ])->otp;
        $this->assertInstanceOf(\OTPHP\HOTP::class, $otp);
    }

    public function testGenerateBackupCodes(): void 
    {
        $this->assertEquals("gown glue immune autumn occur era cave antenna spray cake crack nothing ball drive mother next fade certain average desert flip owner infant buddy",implode(" ",$this->hotp->generateBackupCodes("mysecret")));
    }

    public function testReverseMnemonic(): void 
    {
        $this->assertEquals(hash("md5","mysecret"),$this->hotp->reverseMnemonic("almost awkward just jungle daring keep penalty lecture deputy fossil muscle nasty"));
    }
}
