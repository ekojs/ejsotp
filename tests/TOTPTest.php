<?php declare(strict_types=1);

namespace EJSHelper\Tests;

use PHPUnit\Framework\TestCase;
use Ekojs\Otp\TOTP;

class TOTPTest extends TestCase {
    private $totp;

    protected function setUp(): void
    {
        $this->totp = TOTP::getInstance();
        $this->totp->createOTP([
            "secret" => "mysecret"
        ]);
        $this->totp->otp->setLabel('ekojs@email.com');
        $this->totp->otp->setIssuer("My Service");
    }

    public function testGenerateTotp(): void
    {
        $this->assertEquals("299160",$this->totp->otp->at(1652149726));
    }

    public function testVerifyTotp(): void
    {
        $this->assertTrue($this->totp->otp->verify("299160",1652149726));
    }

    public function testGetParameters(): void
    {
        $this->assertIsArray($this->totp->getParams());
    }

    public function testGenerateQr(): void
    {
        $this->assertEquals("data:image/png;base64,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",$this->totp->generateQr()->getDataUri());
    }

    public function testGenerateQrWithLogoAndLabel(): void
    {
        $this->assertEquals("data:image/png;base64,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",$this->totp->generateQr("./tests/logo.png",true)->getDataUri());
    }

    public function testCreateTotp(): void 
    {
        $otp = $this->totp->createOTP(["secret" => "mysecret1234567890"])->otp;
        $this->assertInstanceOf(\OTPHP\TOTP::class, $otp);
    }

    public function testGenerateBackupCodes(): void 
    {
        $this->assertEquals("gown glue immune autumn occur era cave antenna spray cake crack nothing ball drive mother next fade certain average desert flip owner infant buddy",implode(" ",$this->totp->generateBackupCodes("mysecret")));
    }

    public function testReverseMnemonic(): void 
    {
        $this->assertEquals(hash("md5","mysecret"),$this->totp->reverseMnemonic("almost awkward just jungle daring keep penalty lecture deputy fossil muscle nasty"));
    }
}
